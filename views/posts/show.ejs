<% layout('layouts/post-show-layout') -%>

<h1><%= post.title %></h1>
<div><%= post.price %></div>
<div><%= post.description %></div>
<div><%= post.location %></div>

<% post.images.forEach(function(image){ %>
  <div class="">
      <img src="<%= image.url %>" width="200px">
  </div>
<% });%>

<div id='map'></div> <!-- mapbox map -->

<div class="">
  <a href="/posts/<%= post.id %>/edit">
    <button>Edit</button>
  </a>
</div>
<div class="">
  <form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
    <input type="submit" value="Delete">
  </form>
</div>
<div class="">
  <a href="/posts">Back to Index</a>
</div>

<!-- reviews -->

<h2>Create a Review</h2>
<form action="/posts/<%= post.id %>/reviews/<%= post.review_id %>" method="POST">
  <textarea name="review[body]" required></textarea>
  <input type="number" min="1" max="5" step="1" name="review[rating]" required>
  <input type="submit">
</form>

<h3>Reviews</h3>
<!-- display all reviews -->
<% post.reviews.forEach(function(review) { %>
  <div class="">
    <%= review.body %><br />
    Rating: <%= review.rating %><br />
    By: <%= review.author.username %>
  </div>

  <!-- simple if to only show edit to logged-in users -->
  <% if(review.author.equals(currentUser._id)) { %>
  <div class="">
    <button class="toggle-edit-form">Edit</button>
    <form class="edit-review-form" action="/posts/<%= post.id %>/reviews/<%= review.id %>?_method=PUT" method="POST">
      <textarea name="review[body]" required><%= review.body %></textarea>
      <input type="number" min="1" max="5" step="1" value="<%= review.rating %>" name="review[rating]" required>
      <input type="submit" value="Update">
    </form>
    <form class="" action="/posts/<%= post.id %>/reviews/<%= review.id %>?_method=DELETE" method="POST">
      <input type="submit" value="Delete">
    </form>
  </div>
  <% } %>
      <hr />
<% }); %>
